graph TB
    request["ğŸŒ HTTP Request<br/>(from user's browser)"]
    
    subgraph layers["ğŸ›¡ï¸ Security Layers (Order Matters!)"]
        helmet["1ï¸âƒ£ Helmet<br/>Add security headers<br/>Block common attacks"]
        rateLimit["2ï¸âƒ£ Rate Limiter<br/>Check request count<br/>Block if too many"]
        session["3ï¸âƒ£ Session<br/>Load user session<br/>Track login state"]
        csrf["4ï¸âƒ£ CSRF Check<br/>Verify form token<br/>Reject if missing"]
        validation["5ï¸âƒ£ Input Validation<br/>Sanitize user data<br/>Reject bad input"]
        auth["6ï¸âƒ£ Auth Check<br/>Is user logged in?<br/>Has permission?"]
    end
    
    route["âœ… Your Route Handler<br/>Safe to process request!"]
    response["ğŸ“¤ Response to user"]
    
    blocked["ğŸš« Blocked!<br/>Error response<br/>Attack prevented"]
    
    request --> helmet
    helmet --> rateLimit
    rateLimit -->|"Too many requests?"| blocked
    rateLimit -->|"OK"| session
    session --> csrf
    csrf -->|"Invalid token?"| blocked
    csrf -->|"Valid"| validation
    validation -->|"Bad input?"| blocked
    validation -->|"Clean"| auth
    auth -->|"Not authorized?"| blocked
    auth -->|"Authorized"| route
    route --> response
    
    style request fill:#e7f3ff,stroke:#3273dc
    style layers fill:#f0f0f0,stroke:#666
    style helmet fill:#fff,stroke:#6c757d
    style rateLimit fill:#fff,stroke:#ffc107
    style session fill:#fff,stroke:#17a2b8
    style csrf fill:#fff,stroke:#28a745
    style validation fill:#fff,stroke:#007bff
    style auth fill:#fff,stroke:#6610f2
    style route fill:#d4edda,stroke:#28a745
    style response fill:#d4edda,stroke:#28a745
    style blocked fill:#f8d7da,stroke:#dc3545
